@page "/deleterequest"

@using MauiApp1
@using Radzen
@inject RequestService RequestService
@layout Layoutminu


<div style="text-align:center; margin-top:40px;">
    <RadzenButton Text="🚫 حذف أحدث طلب"
                  Click="@DeleteLastRequest"
                  Style="background-color:red; color:white; border-radius:10px; padding:10px 20px;" />

    @if (!string.IsNullOrWhiteSpace(message))
    {
        <p style="margin-top:20px; color:orange;">@message</p>
    }
</div>

@code {
    string? message;

    protected override async Task OnInitializedAsync()
    {
        await RequestService.InitAsync();
    }

    private async Task DeleteLastRequest()
    {
        try
        {
            var requests = await RequestService.GetRequestsAsync();
            var lastRequest = requests.OrderByDescending(r => r.id).FirstOrDefault();

            if (lastRequest == null)
            {
                message = "⚠️ لا توجد طلبات لحذفها.";
                return;
            }

            await RequestService.DeleteRequestByIdAsync(lastRequest.id!.Value);
            message = $"✅ تم حذف الطلب رقم {lastRequest.id} ({lastRequest.namefode})";
        }
        catch (Exception ex)
        {
            message = $"❌ حدث خطأ أثناء الحذف: {ex.Message}";
        }
    }
}